
<div>
    <span>Links:</span>
    <a class="questionPaperLink" href="{{pastPaperAnswers.paperLink}}" target="_new">Paper</a>
    <a class="questionPaperLink" href="{{pastPaperAnswers.markSchemeLink}}" target="_new">Mark Scheme</a>
</div>

<div>
  <div class="chartContainer">
      <div [chart]="chart" class="chart"></div>
      <div class="chartData">
          <table class="marks">
             <tr>
               <td colspan="3" class="table_title">Marks By Question Level</td>
             </tr>
              <tr>
                <td></td>
                <td>Av</td>
                <td>Ac</td>
              </tr>
              <tr>
                <td>Basic: </td>
                <td class="table_number">{{ sumAvailableMarksByLevel()['basic'] }}</td>
                <td class="table_number">{{ sumActualMarksByLevel()['basic'] }}</td>
              </tr>
      
              <tr>
                  <td>Intermediate: </td>
                  <td class="table_number">{{ sumAvailableMarksByLevel()['intermediate'] }}</td>
                  <td class="table_number">{{ sumActualMarksByLevel()['intermediate'] }}</td>
                </tr>
      
                <tr>
                    <td>Advanced: </td>
                    <td class="table_number">{{ sumAvailableMarksByLevel()['advanced'] }}</td>
                    <td class="table_number">{{ sumActualMarksByLevel()['advanced'] }}</td>
                </tr>
                <tr>
                  <td>Total:</td>
                  <td class="table_number table_total">{{ getTotalAvailableMarks(pastPaperAnswers)}}</td>
                  <td class="table_number table_total">{{ getTotalActualMarks() }}</td>
                </tr>
            <tr><td colspan="3">&nbsp;</td></tr>
            <tr><td colspan="3"  class="table_title">Marks by Mistake</td></tr>
              <tr>
                <td>Not Answered:</td>
                <td>{{ (sumAvailableMarksByMistake()['NA'] || 0) - (sumActualMarksByMistake()['NA'] || 0) }}</td>
              </tr>
              <tr>
                <td>Silly:</td>
                <td>{{ (sumAvailableMarksByMistake()['SI'] || 0) - (sumActualMarksByMistake()['SI'] || 0) }}</td>
              </tr>
              <tr>
                <td>Serious:</td>
                <td>{{ (sumAvailableMarksByMistake()['SE'] || 0) - (sumActualMarksByMistake()['SE'] || 0) }}</td>
              </tr>
              <tr>
                <td>Correct:</td>
                <td>{{ getTotalActualMarks() }}</td>
              </tr>
            </table>
      </div>
  </div>
</div>

<div *ngIf="!answersForm.valid">Form is Invalid</div>

<form [formGroup]="answersForm" novalidate (ngSubmit)="savePastPaperAnswers(answersForm)">
    <button mat-primary type="submit">Save Marks</button>
  <div>
    <div formArrayName="answers" class="paperContainer">
      <div class="paperQuestion" *ngFor="let answer of formData.controls; let i = index;">
        
        
        <div [formGroupName]="i">
          
          <div class="paperQuestionField" style="grid-area: number">
                <div>Q{{ answer.controls.number.value }} ({{ answer.controls.available_marks.value}} marks)</div>
                <div>type: <a [routerLink]="answer.controls.link.value">{{ answer.controls.type.value }}</a></div>
                <div>level: {{ answer.controls.level.value }}</div>
            </div> 
          <div class="paperQuestionField" style="grid-area: aMarks">
            <input [className]="hasError(i, 'actual_marks')" 
                   formControlName="actual_marks" 
                   type="number" 
                   pInputText
                   (change)="onChangeInput($event, i)"
                   >
          </div>
          <div *ngIf="getErrors(i, 'actual_marks')">
            <div class="error_message" *ngIf="getErrors(i, 'actual_marks')['minVal']">The min value is 0.</div>
            <div class="error_message" *ngIf="getErrors(i, 'actual_marks')['maxVal']">You have entered more marks than are allocated to this question.</div>
            <div class="error_message" *ngIf="getErrors(i, 'actual_marks')['required']">A value is required.</div>
            <!-- <div>{{getErrors(i, 'actual_marks') | json}}</div> -->
          </div>

          <div>
            <div></div>
          </div>

          <div class="paperQuestionField" style="grid-area: mType">
              <p-dropdown [options]="mistakeTypes" optionLabel="name" formControlName="mistake_type"></p-dropdown>
            </div>
            <div *ngIf="getErrors(i, 'mistake_type')">
                <div class="error_message" *ngIf="getErrors(i, 'mistake_type')['InvalidValueEq']">Invalid value when actual marks = availale marks.</div>
                <div class="error_message" *ngIf="getErrors(i, 'mistake_type')['InvalidValueNeq']">Invalid value when actual marks != availale marks.</div>
            </div>
        
        </div>
  
        </div>
      </div>
      </div>  
  </form>

